{
  "name": "Multi-Persona Test Scenarios",
  "description": "Collection of scenarios for testing multi-persona functionality",
  "scenarios": [
    {
      "name": "Independent Persona States",
      "description": "Tests that personas maintain independent state and data",
      "setup": {
        "mockResponses": [
          {
            "endpoint": "/v1/chat/completions",
            "response": {
              "type": "fixed",
              "content": "Independent persona response.",
              "delayMs": 200
            }
          }
        ],
        "initialData": {
          "personas": [
            {
              "name": "persona-a",
              "systemPrompt": "You are Persona A, focused on technical topics.",
              "initialMessages": []
            },
            {
              "name": "persona-b",
              "systemPrompt": "You are Persona B, focused on creative topics.",
              "initialMessages": []
            }
          ]
        }
      },
      "steps": [
        {
          "type": "command",
          "action": "/persona switch persona-a",
          "timeout": 3000
        },
        {
          "type": "input",
          "action": "Technical question for Persona A",
          "timeout": 5000
        },
        {
          "type": "wait",
          "action": "llm_request",
          "timeout": 3000
        },
        {
          "type": "wait",
          "action": "ui:Independent persona response",
          "timeout": 8000
        },
        {
          "type": "command",
          "action": "/persona switch persona-b",
          "timeout": 3000
        },
        {
          "type": "input",
          "action": "Creative question for Persona B",
          "timeout": 5000
        },
        {
          "type": "wait",
          "action": "llm_request",
          "timeout": 3000
        },
        {
          "type": "wait",
          "action": "ui:Independent persona response",
          "timeout": 8000
        },
        {
          "type": "command",
          "action": "/quit",
          "timeout": 3000
        }
      ],
      "assertions": [
        {
          "type": "file",
          "target": "personas/persona-a/system.jsonc",
          "condition": "exists",
          "expected": true
        },
        {
          "type": "file",
          "target": "personas/persona-b/system.jsonc",
          "condition": "exists",
          "expected": true
        },
        {
          "type": "ui",
          "target": "output",
          "condition": "contains",
          "expected": "Independent persona response"
        },
        {
          "type": "process",
          "target": "mock_server",
          "condition": "mock_requests",
          "expected": 2
        }
      ],
      "cleanup": {
        "killProcesses": true,
        "restoreEnvironment": true
      }
    },
    {
      "name": "Concurrent Persona Processing",
      "description": "Tests concurrent processing across multiple personas",
      "setup": {
        "mockResponses": [
          {
            "endpoint": "/v1/chat/completions",
            "response": {
              "type": "fixed",
              "content": "Concurrent processing response.",
              "delayMs": 1000
            }
          }
        ]
      },
      "steps": [
        {
          "type": "command",
          "action": "/persona create concurrent-1",
          "timeout": 3000
        },
        {
          "type": "input",
          "action": "Message for concurrent-1",
          "timeout": 5000
        },
        {
          "type": "command",
          "action": "/persona create concurrent-2",
          "timeout": 3000
        },
        {
          "type": "input",
          "action": "Message for concurrent-2",
          "timeout": 5000
        },
        {
          "type": "wait",
          "action": "ui:Concurrent processing response",
          "timeout": 15000
        },
        {
          "type": "command",
          "action": "/quit",
          "timeout": 3000
        }
      ],
      "assertions": [
        {
          "type": "ui",
          "target": "output",
          "condition": "contains",
          "expected": "Concurrent processing response"
        },
        {
          "type": "process",
          "target": "mock_server",
          "condition": "mock_requests",
          "expected": 2
        }
      ],
      "cleanup": {
        "killProcesses": true,
        "restoreEnvironment": true
      }
    },
    {
      "name": "Persona Switching and Unread Management",
      "description": "Tests persona switching and unread count management",
      "setup": {
        "mockResponses": [
          {
            "endpoint": "/v1/chat/completions",
            "response": {
              "type": "fixed",
              "content": "Persona switching test response.",
              "delayMs": 300
            }
          }
        ]
      },
      "steps": [
        {
          "type": "command",
          "action": "/persona create switch-test-1",
          "timeout": 3000
        },
        {
          "type": "input",
          "action": "Message to switch-test-1",
          "timeout": 5000
        },
        {
          "type": "wait",
          "action": "llm_request",
          "timeout": 3000
        },
        {
          "type": "wait",
          "action": "ui:Persona switching test response",
          "timeout": 8000
        },
        {
          "type": "command",
          "action": "/persona create switch-test-2",
          "timeout": 3000
        },
        {
          "type": "input",
          "action": "Message to switch-test-2",
          "timeout": 5000
        },
        {
          "type": "wait",
          "action": "llm_request",
          "timeout": 3000
        },
        {
          "type": "wait",
          "action": "ui:Persona switching test response",
          "timeout": 8000
        },
        {
          "type": "command",
          "action": "/persona switch switch-test-1",
          "timeout": 3000
        },
        {
          "type": "command",
          "action": "/persona switch switch-test-2",
          "timeout": 3000
        },
        {
          "type": "command",
          "action": "/quit",
          "timeout": 3000
        }
      ],
      "assertions": [
        {
          "type": "ui",
          "target": "output",
          "condition": "contains",
          "expected": "Persona switching test response"
        },
        {
          "type": "process",
          "target": "mock_server",
          "condition": "mock_requests",
          "expected": 2
        }
      ],
      "cleanup": {
        "killProcesses": true,
        "restoreEnvironment": true
      }
    }
  ]
}